@model MRTD.Core.Models.ModuleModel;
@using BusinessSchoolMLS.SchoolBusinessComponent;

@{
    ViewData["Title"] = "Program Unit";
    var faculty_component = new FacultyBusinessComponent();
    int qual_id = ViewBag.QualID;
    int fac_id = ViewBag.FacultyID;
    string mguid = ViewBag.MemGuid;
    var fac_qual = faculty_component.GetAllFacultyQualificationByFacultyID(fac_id).FirstOrDefault(qual => qual.QualificationID == qual_id);
    var lst_all_qual_modules = faculty_component.GetAllFacultyModuleByQualificationID(qual_id);

}

<div>
    &nbsp;
</div>
<div>
    <h2 style="color: #6d2829;">Program Unit - @fac_qual.QualificationName</h2>
</div>

<div>
    <button type="button" data-toggle="modal" class="btn btn-default" data-target="#create-module">Add Unit</button>
</div>
<div>
    <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th>Unit ID</th>
                    <th>Name</th>
                    <th>Program</th>
                    <th>NQF Level</th>
                    <th>Credits</th>
                    <th>Level</th>
                    <th></th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var qual_module in lst_all_qual_modules)
                {
                    <tr>
                        <td>@qual_module.ModuleUnitCode</td>
                        <td>@qual_module.ModuleName</td>
                        <td>@fac_qual.QualificationName</td>
                        <td>@qual_module.NQLevelID</td>
                        <td>@qual_module.Credit</td>
                        <td>@qual_module.AcademicLevelID</td>
                        <td><a href="#" data-toggle="modal" data-target="#@qual_module.ModuleUnitCode">Edit</a></td>
                        <td>@Html.ActionLink("Activity", "activities", "ModuleActivity", new { mid = mguid, modid = qual_module.ModuleID, qid = qual_id, fid = fac_id })</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@foreach (var qual_module in lst_all_qual_modules)
{
    <div id="@qual_module.ModuleUnitCode" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Edit Unit</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                </div>
                <div class="modal-body">
                    @using (Html.BeginForm("EditModule", "SchoolFaculty", FormMethod.Post))
                    {
                        <input type="hidden" name="MemberID" value="@mguid" />
                        <input type="hidden" name="QualificationID" value="@qual_id" />
                        <input type="hidden" name="FacultyID" value="@fac_id" />
                        <input type="hidden" name="ModuleID" value="@qual_module.ModuleID" />
                        <div class="form-group">
                            <label for="ModuleName">Unit Name</label>
                            <input type="text" name="ModuleName" class="form-control" value="@qual_module.ModuleName" />
                        </div>
                        <div class="form-group">
                            <label for="ModuleDescription">Unit Description</label>
                            <textarea name="ModuleDescription" class="form-control">@qual_module.ModuleDescription</textarea>
                        </div>
                        <div class="form-group">
                            <label for="ModuleUnitCode">Unit ID</label>
                            <input type="text" name="ModuleUnitCode" class="form-control" value="@qual_module.ModuleUnitCode" />
                        </div>
                        <div class="form-group">
                            <label for="StockPrice">Module Price</label>
                            <input type="text" name="StockPrice" class="form-control" value="@qual_module.StockPrice" />
                        </div>
                        <div class="form-group">
                            <label for="NQLevelID">NQF Level</label>
                            <select name="NQLevelID" class="form-control">
                                <option value="0">---Please select one---</option>
                                @foreach (var level in Model.ModuleNQLevels)
                                {
                                    if (int.Parse(level.Value) == qual_module.NQLevelID)
                                    {
                                        <option value="@level.Value.ToString()" selected="selected">@level.Text</option>
                                    }
                                    else
                                    {
                                        <option value="@level.Value.ToString()">@level.Text</option>
                                    }

                                }
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="Credit">Unit Credits</label>
                            <input type="number" name="Credit" class="form-control" min="0" max="500" value="@qual_module.Credit" />
                        </div>
                        <div class="form-group">
                            <label for="AcademicLevelID">Unit Level</label>
                            <select name="AcademicLevelID" class="form-control">
                                <option value="0">---Please select one---</option>
                                @foreach (var level in Model.ModuleNQLevels)
                                {
                                    if (int.Parse(level.Value) == qual_module.AcademicLevelID)
                                    {
                                        <option value="@level.Value.ToString()" selected="selected">@level.Text</option>
                                    }
                                    else
                                    {
                                        <option value="@level.Value.ToString()">@level.Text</option>
                                    }

                                }
                            </select>
                        </div>
                        <div style="width: 100%; text-align: center;">
                            <button type="submit" class="btn btn-default" style="width: 100px;" data-toggle="modal">Save</button>
                            <button type="button" class="btn btn-default" style="width: 100px;" data-dismiss="modal">Cancel</button>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
}


<div id="create-module" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Create Unit</h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            </div>
            <div class="modal-body">
                @using (Html.BeginForm("AddModule", string.Format("SchoolFaculty"), FormMethod.Post))
                {
                    <input type="hidden" name="MemberID" value="@mguid" />
                    <input type="hidden" name="QualificationID" value="@qual_id" />
                    <input type="hidden" name="FacultyID" value="@fac_id" />
                    <div class="form-group">
                        @Html.LabelFor(model => model.ModuleName)
                        @Html.TextBoxFor(model => model.ModuleName, new { @class = "form-control" })
                    </div>
                    <div class="form-group">
                        @Html.LabelFor(model => model.ModuleDescription)
                        @Html.TextAreaFor(model => model.ModuleDescription, new { @class = "form-control" })
                    </div>
                    <div class="form-group">
                        @Html.LabelFor(model => model.ModuleUnitCode)
                        @Html.TextBoxFor(model => model.ModuleUnitCode, new { @class = "form-control" })
                    </div>
                    <div class="form-group">
                        @Html.LabelFor(model => model.StockPrice)
                        @Html.TextBoxFor(model => model.StockPrice, new { @class = "form-control", @type = "number" })
                    </div>
                    <div class="form-group">
                        @Html.LabelFor(model => model.NQLevelID)
                        @Html.DropDownListFor(model => model.NQLevelID, Model.ModuleNQLevels, new { @class = "form-control", @validation = "select" })
                    </div>
                    <div class="form-group">
                        @Html.LabelFor(model => model.Credit)
                        @Html.TextBoxFor(model => model.Credit, new { @class = "form-control", @type = "number" })
                    </div>
                    <div class="form-group">
                        @Html.LabelFor(model => model.AcademicLevelID)
                        @Html.DropDownListFor(model => model.AcademicLevelID, Model.ModuleNQLevels, new { @class = "form-control" })
                    </div>
                    <div style="width: 100%; text-align: center;">
                        <button type="submit" class="btn btn-default" style="width: 100px;" data-toggle="modal">Save</button>
                        <button type="button" class="btn btn-default" style="width: 100px;" data-dismiss="modal">Cancel</button>
                    </div>
                }
            </div>
        </div>
    </div>
</div>